{% extends 'base.html.twig' %}

{% block title %}{{ 'student.preview.title'|trans }}{% endblock %}

{% block body %}
<div class="max-w-4xl mx-auto py-12 mt-16">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-2xl font-bold">{{ 'student.preview.heading'|trans }}</h1>
        <div class="flex gap-4">
            <a href="{{ path('app_student_registration_pdf', {'id': student.id}) }}" 
               class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded inline-flex items-center">
                <span>{{ 'student.preview.generate_pdf'|trans }}</span>
            </a>
            <a href="{{ path('app_student_edit', {'id': student.id}) }}" 
               class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded inline-flex items-center">
                <span>{{ 'student.preview.edit'|trans }}</span>
            </a>
        </div>
    </div>
    
    <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
        <div class="grid grid-cols-2 gap-8">
            <div class="space-y-6">
                <div>
                    <h2 class="text-lg font-semibold mb-4 text-gray-700 border-b pb-2">{{ 'student.preview.personal_info'|trans }}</h2>
                    <div class="space-y-2">
                        <p><span class="font-medium text-gray-600">{{ 'student.id'|trans }}:</span> {{ student.id }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.fullname'|trans }}:</span> {{ student.fullName }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.birthdate'|trans }}:</span> {{ student.birthDate ? student.birthDate|date('d/m/Y') : '' }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.gender'|trans }}:</span> {{ student.gender }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.nationality'|trans }}:</span> {{ student.nationality }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.handicap'|trans }}:</span> {{ student.handicap ? 'Oui' : 'Non' }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.baccalaureat'|trans }}:</span> {{ student.baccalaureat }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.language'|trans }}:</span> {{ student.language }}</p>
                    </div>
                </div>

                <div>
                    <h2 class="text-lg font-semibold mb-4 text-gray-700 border-b pb-2">{{ 'student.preview.contact_info'|trans }}</h2>
                    <div class="space-y-2">
                        <p><span class="font-medium text-gray-600">{{ 'student.address'|trans }}:</span> {{ student.address }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.phone'|trans }}:</span> {{ student.phone }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.email'|trans }}:</span> {{ student.email }}</p>
                    </div>
                </div>
            </div>

            <div class="space-y-6">
                <div>
                    <h2 class="text-lg font-semibold mb-4 text-gray-700 border-b pb-2">{{ 'student.preview.parent_info'|trans }}</h2>
                    <div class="space-y-2">
                        <p><span class="font-medium text-gray-600">{{ 'student.father_name'|trans }}:</span> {{ student.parentName }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.father_phone'|trans }}:</span> {{ student.parentPhone }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.mother_name'|trans }}:</span> {{ student.motherName }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.mother_phone'|trans }}:</span> {{ student.motherPhone }}</p>
                    </div>
                </div>

                <div>
                    <h2 class="text-lg font-semibold mb-4 text-gray-700 border-b pb-2">{{ 'student.preview.academic_info'|trans }}</h2>
                    <div class="space-y-2">
                        <p><span class="font-medium text-gray-600">{{ 'student.academic_year'|trans }}:</span> {{ student.academicYear }}</p>
                        <p><span class="font-medium text-gray-600">{{ 'student.activities'|trans }}:</span> {{ student.activities ? student.activities|json_encode : 'Aucune activitÃ©' }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const pdfButton = document.querySelector('a[href*="app_student_registration_pdf"]');
  
  if (pdfButton) {
    pdfButton.addEventListener('click', function(e) {
      e.preventDefault();
      
      // First, trigger the PDF download by opening in a new window/tab
      const pdfUrl = this.getAttribute('href');
      window.open(pdfUrl, '_blank');
      
      // Then redirect to home page
      window.location.href = "{{ path('app_home') }}";
    });
  }
});
</script>
{% endblock %}